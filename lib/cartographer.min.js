(function(a){var b,c;b=function(){var a,b,c;return b=this,c=[],a=function(a){var b,c;return c=$("#"+a+"-template > :only-child"),b=$("#"+a),c.length>0?c[0]:b.length>0?b[0]:null},this.addSource=function(a){return c.push(a)},this.resolve=function(b,d,e){var f,g,h;return h=a(b),h?d(h):(g=0,f=function(){return c[g].resolve(b,function(a){return d($(a)[0],function(){return g++,f()})})})},b},c=new b;var d;d=function(){var a;return a=this,postal.channel("cartographer").subscribe(function(b){if(b.map)return a.map(b.name,b.namespace);if(b.apply)return a.apply(b.template,b.proxy,b.render,b.error)}),this.templates={},this.map=function(a,b){var c;return c=new e(a,b),this.templates[a]=c},this.apply=function(a,b,c,d){var e;a=a||(a=b.__template__),e=this.templates[a];if(e)return e.apply(b,function(a){return c?c(a,e.fqn):$("#"+e.name).replaceWith(a)});if(d)return d()},a},a.cartographer=new d;var e;e=function(a,b){var d,e,f,g,h,i,j,k,l,m,n;j=this;var o,p,q,r;return o={click:"onclick",dblclick:"ondblclick",mousedown:"onmousedown",mouseup:"onmouseup",mouseover:"onmouseover",mousemove:"onmousemove",mouseout:"onmouseout",keydown:"onkeydown",keypress:"onkeypress",keyup:"onkeyup",select:"onselect",change:"onchange",focus:"onfocus",blur:"onblur",scroll:"onscroll",resize:"onresize",submit:"onsubmit"},p={hide:"hidden",title:"title","class":"className",value:["value","textContent"]},q={hide:"hidden",title:"title",value:"value","class":"className"},r={id:"id",name:"name",title:"title",className:"class",type:"type",width:"width",height:"height",value:"value"},d=function(a,b,c,d){var e,f,g,h,i;e=a[c];if(e!==void 0){if(_.isArray(d)){i=[];for(g=0,h=d.length;g<h;g++)f=d[g],i.push(b[f]=e);return i}return b[d]=e}},e=function(a,b,c){var e,f,g,h,i;h=_.keys(c),i=[];for(f=0,g=h.length;f<g;f++)e=h[f],i.push(d(a,b,e,c[e]));return i},f=function(a,b,d,e,f){var h,j;return h=g(d,e!=null?e.id:void 0),((j=b[h])!=null?j.__template__:void 0)&&e&&e.id&&!e.nested?c.resolve(b[h].__template__,function(c){return e=c,console.log("*** "+d+" - "+e.id+" - "+e.tagName+" ***"),e.nested=!0,i(a,b,d,e,f)}):i(a,b,d,e,f)},g=function(a,b){var c;return b===void 0||b===""?c=a:a===void 0||a===""?c=b:a===b?c=a:c=""+a+"."+b,c},h=function(a,b,c,d,f,g,h,i,j){var l,m,n,o;n={},o=d.textContent?d.textContent:d.value,l=h?h:o,m={};if(g||g===0)n.id=g;d&&e(d,n,r),c==="INPUT"?(_.isObject(l)||(n.value=l),m=b[c](n)):m=b[c](n,l);if(j!=null?j[g]:void 0)h instanceof Array?e(j[g],m,q):e(j[g],m,p);return k(j!=null?j[g]:void 0,i,f,m,a),m},i=function(a,b,c,d,e){var i,j,k,l,m,n,o,p,q,r,s;m=d.id,l=g(c,m),o=d.tagName.toUpperCase(),console.log(""+c+" - "+m+" - "+o),a=a||b;if(d.children!==void 0&&d.children.length>0){k=[],n=function(f){var i;k.push(f);if(k.length===d.children.length)return i=function(e,f,i,j){var n,p,q,r,s,t,u,v,w,x,y;n=m===""?j:m,w=g(i,n),x=n===l||n===void 0?f:f!=null?f[n]:void 0,console.log(""+c+" - "+m+" - "+w+" - "+n+" - "+x+" - "+f+" "),s=x.length?x:x!=null?x.items:void 0;if(s&&s.length){v=[],r=k[0],a.template[w+"_add"]=function(a,b){return r(e,b,w,a)};for(u=0,y=s.length-1;0<=y?u<=y:u>=y;0<=y?u++:u--)v.push(function(){var a,b,c;c=[];for(a=0,b=k.length;a<b;a++)p=k[a],c.push(p(e,s,w,u));return c}());return q=h(a,e,o,d,w,n,v,b,f),a[w]=q,q}return t=function(){var a,b,c;c=[];for(a=0,b=k.length;a<b;a++)p=k[a],c.push(p(e,x,w));return c}(),q=h(a,e,o,d,w,n,t,b,f),a[w]=q,q},a.template[l]=i,e(i)},r=d.children,s=[];for(p=0,q=r.length;p<q;p++)j=r[p],s.push(f(a,b,l,j,function(a){return n(a)}));return s}return i=function(c,e,f,i){var j,k,n,p;return j=m===""?i:m,n=g(f,j),p=j===l?e:e!=null?e[j]:void 0,k=h(a,c,o,d,n,j,p,b,e),a[n]=k,k},a.template[l]=i,e(i)},k=function(a,b,c,d,e){var f,g,h,i,j;if(a){i=_.keys(o),j=[];for(g=0,h=i.length;g<h;g++)f=i[g],j.push(n(f,o[f],a,b,c,d,e));return j}},l=function(a,b){return this.changeSubscription&&this.changeSubscription.unsubscribe&&this.changeSubscription.ubsubscribe(),this.changesSubscription=postal.channel(b).subscribe(function(b){var c,e,f,g,h,i,k;if(b.event!=="read"){f=a[b.key],g=b.key.lastIndexOf("."),i=b.key.substring(0,g),e=b.key.substring(g+1),k="value";if(e==="value"||!f)f=a[i],k=e;if(b.event==="wrote"){if(f)return b.info.value.isProxy?$(a[b.key]).replaceWith(a.template[b.key](j.html,b.info.value.getRoot(),i)):d(b.info,f,"value",p[k])}else if(b.event==="added")return c=i+"_add",h=a.template[c](e,b.parent),$(a[i]).append(h)}})},m=function(a){var b;return b=a.lastIndexOf("."),a.substring(0,b)},n=function(a,b,c,d,e,f,g){return f[b]=function(f){return b==="onchange"&&f.stopPropagation(),g.eventChannel.publish({alias:a,id:e,info:f,control:g[e],context:g,event:b,model:c,root:d})}},this.apply=function(a,c){return f(j,a,b,j.element,function(b){return c(b(j.html,a))})},this.name=a,this.fqn=b,this.element={},this.eventChannel=postal.channel(this.fqn+"_events"),this.html=DOMBuilder.dom,this.template={},c.resolve(a,function(a){return j.element=a,console.log(a)}),l(j,j.fqn+"_model"),j}})(window)