(function(a){var b;b=function(){var a;return a=this,postal.channel("cartographer").subscribe(function(b){if(b.map)return a.map(b.target,b.namespace);if(b.apply)return a.apply(b.template,b.proxy,b.render,b.error)}),this.templates={},this.map=function(a,b){var d;return d=new c(a,b),this.templates[d.fqn]=d},this.apply=function(a,b,c,d){var e,f;f=this.templates[a];if(f)return e=f.apply(b),c?c(e,f.fqn):$("#"+f.fqn).replaceWith(e);if(d)return d()},a},a.cartographer=new b;var c;c=function(a,b){var c,d,e,f,g,h,i,j,k;h=this;var l,m,n,o;return l={click:"onclick",dblclick:"ondblclick",mousedown:"onmousedown",mouseup:"onmouseup",mouseover:"onmouseover",mousemove:"onmousemove",mouseout:"onmouseout",keydown:"onkeydown",keypress:"onkeypress",keyup:"onkeyup",select:"onselect",change:"onchange",focus:"onfocus",blur:"onblur",scroll:"onscroll",resize:"onresize",submit:"onsubmit"},m={hide:"hidden",title:"title","class":"className",value:["value","textContent"]},n={hide:"hidden",title:"title",value:"value","class":"className"},o={id:"id",name:"name",title:"title",className:"class",type:"type",width:"width",height:"height",value:"value"},c=function(a,b,c,d){var e,f,g,h,i;e=a[c];if(e!==void 0){if(_.isArray(d)){i=[];for(g=0,h=d.length;g<h;g++)f=d[g],i.push(b[f]=e);return i}return b[d]=e}},d=function(a,b,d){var e,f,g,h,i;h=_.keys(d),i=[];for(f=0,g=h.length;f<g;f++)e=h[f],i.push(c(a,b,e,d[e]));return i},e=function(a,b,c,d){var h,i,j,k,l,m;return l=d.id,k=f(c,l),m=d.tagName.toUpperCase(),a=a||b,d.children!==void 0&&d.children.length>0?(j=function(){var c,f,g,h;g=d.children,h=[];for(c=0,f=g.length;c<f;c++)i=g[c],h.push(e(a,b,k,i));return h}(),h=function(c,e,h,i){var n,o,p,q,r,s,t,u,v,w,x;n=l===""?i:l,v=f(h,n),w=n===k||n===void 0?e:e!=null?e[n]:void 0,r=w.length?w:w!=null?w.items:void 0;if(r&&r.length){u=[],q=j[0],a.template[v+"_add"]=function(a,b){return q(c,b,v,a)};for(t=0,x=r.length-1;0<=x?t<=x:t>=x;0<=x?t++:t--)u.push(function(){var a,b,d;d=[];for(a=0,b=j.length;a<b;a++)o=j[a],d.push(o(c,r,v,t));return d}());return p=g(a,c,m,d,v,n,u,b,e),a[v]=p,p}return s=function(){var a,b,d;d=[];for(a=0,b=j.length;a<b;a++)o=j[a],d.push(o(c,w,v));return d}(),p=g(a,c,m,d,v,n,s,b,e),a[v]=p,p},a.template[k]=h,h):(h=function(c,e,h,i){var j,n,o,p;return j=l===""?i:l,o=f(h,j),p=j===k?e:e!=null?e[j]:void 0,n=g(a,c,m,d,o,j,p,b,e),a[o]=n,n},a.template[k]=h,h)},f=function(a,b){var c;return b===void 0||b===""?c=a:a===void 0||a===""?c=b:c=""+a+"."+b,c},g=function(a,b,c,e,f,g,h,j,k){var l,p,q,r;q={},r=e.textContent?e.textContent:e.value,l=h?h:r,p={};if(g||g===0)q.id=g;e&&d(e,q,o),c==="INPUT"?(_.isObject(l)||(q.value=l),p=b[c](q)):p=b[c](q,l);if(k!=null?k[g]:void 0)h instanceof Array?d(k[g],p,n):d(k[g],p,m);return i(k!=null?k[g]:void 0,j,f,p,a),p},i=function(a,b,c,d,e){var f,g,h,i,j;if(a){i=_.keys(l),j=[];for(g=0,h=i.length;g<h;g++)f=i[g],j.push(k(f,l[f],a,b,c,d,e));return j}},j=function(b,d){return this.changeSubscription&&this.changeSubscription.unsubscribe&&this.changeSubscription.ubsubscribe(),this.changesSubscription=postal.channel(d).subscribe(function(d){var e,f,g,i,j,k;if(d.event!=="read"){g=b[d.key],i=d.key.lastIndexOf("."),k=d.key.substring(0,i),f=d.key.substring(i+1),a="value";if(f==="value"||!g)g=b[k],a=f;if(d.event==="wrote"){if(g)return d.info.value.isProxy?$(b[d.key]).replaceWith(b.template[d.key](h.html,d.info.value.getRoot(),k)):c(d.info,g,"value",m[a])}else if(d.event==="added")return e=k+"_add",j=b.template[e](f,d.parent),$(b[k]).append(j)}})},k=function(a,b,c,d,e,f,g){var h,i;return h=c[a],h?(i=function(a){return h.apply(c,[d,{id:e,control:g[e],event:b,context:g,info:a}])},f[b]=i):f[b]=function(a){return b==="onchange"&&a.stopPropagation(),g.eventChannel.publish({id:e,model:c,control:g[e],event:b,context:g,info:a})}},this.apply=function(a){var c;return c=e(this,a,b,this.element,this.apply),c(this.html,a)},this.element=$(a)[0],this.fqn=f(b,this.element.id),this.eventChannel=postal.channel(this.fqn+"_events"),this.html=DOMBuilder.dom,this.template={},j(h,h.fqn+"_model"),this}})(window)