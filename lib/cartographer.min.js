(function(a){var b,c;b=function(){var a,b,c,d;return c=this,d=[],a=function(a){var b;return b=$("#"+a),b?b[0]:null},b=function(a){var b;return b=_.find(d,function(b){return b.resolve(a)}),$(b)[0]},this.addSource=function(a){return d.push(a)},this.resolve=function(c){var d;return d=a(c),d||(d=b(c))},c},c=new b;var d;d=function(){var a;return a=this,postal.channel("cartographer").subscribe(function(b){if(b.map)return a.map(b.name);if(b.apply)return a.apply(b.template,b.proxy,b.render,b.error)}),this.templates={},this.map=function(a,b){var c;return c=new e(a,b),this.templates[a]=c},this.apply=function(a,b,c,d){var e,f;a=a||(a=b.__template__),f=this.templates[a];if(f)return e=f.apply(b),c?c(e,f.fqn):$("#"+f.name).replaceWith(e);if(d)return d()},a},a.cartographer=new d;var e;e=function(a,b){var d,e,f,g,h,i,j,k,l;i=this;var m,n,o,p;return m={click:"onclick",dblclick:"ondblclick",mousedown:"onmousedown",mouseup:"onmouseup",mouseover:"onmouseover",mousemove:"onmousemove",mouseout:"onmouseout",keydown:"onkeydown",keypress:"onkeypress",keyup:"onkeyup",select:"onselect",change:"onchange",focus:"onfocus",blur:"onblur",scroll:"onscroll",resize:"onresize",submit:"onsubmit"},n={hide:"hidden",title:"title","class":"className",value:["value","textContent"]},o={hide:"hidden",title:"title",value:"value","class":"className"},p={id:"id",name:"name",title:"title",className:"class",type:"type",width:"width",height:"height",value:"value"},d=function(a,b,c,d){var e,f,g,h,i;e=a[c];if(e!==void 0){if(_.isArray(d)){i=[];for(g=0,h=d.length;g<h;g++)f=d[g],i.push(b[f]=e);return i}return b[d]=e}},e=function(a,b,c){var e,f,g,h,i;h=_.keys(c),i=[];for(f=0,g=h.length;f<g;f++)e=h[f],i.push(d(a,b,e,c[e]));return i},f=function(a,b,c,d){var e,i,j,k,l,m;return l=d.id,k=g(c,l),m=d.tagName.toUpperCase(),a=a||b,d.children!==void 0&&d.children.length>0?(j=function(){var c,e,g,h;g=d.children,h=[];for(c=0,e=g.length;c<e;c++)i=g[c],h.push(f(a,b,k,i));return h}(),e=function(c,e,f,i){var n,o,p,q,r,s,t,u,v,w,x;n=l===""?i:l,v=g(f,n),w=n===k||n===void 0?e:e!=null?e[n]:void 0,r=w.length?w:w!=null?w.items:void 0;if(r&&r.length){u=[],q=j[0],a.template[v+"_add"]=function(a,b){return q(c,b,v,a)};for(t=0,x=r.length-1;0<=x?t<=x:t>=x;0<=x?t++:t--)u.push(function(){var a,b,d;d=[];for(a=0,b=j.length;a<b;a++)o=j[a],d.push(o(c,r,v,t));return d}());return p=h(a,c,m,d,v,n,u,b,e),a[v]=p,p}return s=function(){var a,b,d;d=[];for(a=0,b=j.length;a<b;a++)o=j[a],d.push(o(c,w,v));return d}(),p=h(a,c,m,d,v,n,s,b,e),a[v]=p,p},a.template[k]=e,e):(e=function(c,e,f,i){var j,n,o,p;return j=l===""?i:l,o=g(f,j),p=j===k?e:e!=null?e[j]:void 0,n=h(a,c,m,d,o,j,p,b,e),a[o]=n,n},a.template[k]=e,e)},g=function(a,b){var c;return b===void 0||b===""?c=a:a===void 0||a===""?c=b:c=""+a+"."+b,c},h=function(a,b,c,d,f,g,h,i,k){var l,m,q,r;q={},r=d.textContent?d.textContent:d.value,l=h?h:r,m={};if(g||g===0)q.id=g;d&&e(d,q,p),c==="INPUT"?(_.isObject(l)||(q.value=l),m=b[c](q)):m=b[c](q,l);if(k!=null?k[g]:void 0)h instanceof Array?e(k[g],m,o):e(k[g],m,n);return j(k!=null?k[g]:void 0,i,f,m,a),m},j=function(a,b,c,d,e){var f,g,h,i,j;if(a){i=_.keys(m),j=[];for(g=0,h=i.length;g<h;g++)f=i[g],j.push(l(f,m[f],a,b,c,d,e));return j}},k=function(a,b){return this.changeSubscription&&this.changeSubscription.unsubscribe&&this.changeSubscription.ubsubscribe(),this.changesSubscription=postal.channel(b).subscribe(function(b){var c,e,f,g,h,j,k;if(b.event!=="read"){f=a[b.key],g=b.key.lastIndexOf("."),j=b.key.substring(0,g),e=b.key.substring(g+1),k="value";if(e==="value"||!f)f=a[j],k=e;if(b.event==="wrote"){if(f)return b.info.value.isProxy?$(a[b.key]).replaceWith(a.template[b.key](i.html,b.info.value.getRoot(),j)):d(b.info,f,"value",n[k])}else if(b.event==="added")return c=j+"_add",h=a.template[c](e,b.parent),$(a[j]).append(h)}})},l=function(a,b,c,d,e,f,g){var h,i;return h=c[a],h?(i=function(a){return h.apply(c,[d,{id:e,control:g[e],event:b,context:g,info:a}])},f[b]=i):f[b]=function(a){return b==="onchange"&&a.stopPropagation(),g.eventChannel.publish({id:e,model:c,control:g[e],event:b,context:g,info:a})}},this.apply=function(a){var c;return c=f(this,a,b,this.element,this.apply),c(this.html,a)},this.name=a,this.fqn=b,this.element=c.resolve(a),this.eventChannel=postal.channel(this.fqn+"_events"),this.html=DOMBuilder.dom,this.template={},k(i,i.fqn+"_model"),this}})(window)