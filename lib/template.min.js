var Template,turlet;Template=function(a,b,c){var d,e,f,g,h,i,j;j=this;var k,l,m,n;return k={click:"onclick",dblclick:"ondblclick",mousedown:"onmousedown",mouseup:"onmouseup",mouseover:"onmouseover",mousemove:"onmousemove",mouseout:"onmouseout",keydown:"onkeydown",keypress:"onkeypress",keyup:"onkeyup",select:"onselect",change:"onchange",focus:"onfocus",blur:"onblur",scroll:"onscroll",resize:"onresize",submit:"onsubmit"},l={hide:"hidden",title:"title","class":"className",value:["value","textContent"]},m={hide:"hidden",title:"title",value:"value","class":"className"},n={id:"id",name:"name",title:"title",className:"class",type:"type",width:"width",height:"height",value:"value"},d=function(a,b,c,d){var e,f,g,h;if(_.isArray(d)){h=[];for(f=0,g=d.length;f<g;f++)e=d[f],h.push(b[e]=a[c]||b[e]);return h}return b[d]=a[c]||b[d]},e=function(a,b,c){var e,f,g,h,i;if(a&&b){h=_.keys(c),i=[];for(f=0,g=h.length;f<g;f++)e=h[f],i.push(d(a,b,e,c[e]));return i}},f=function(a,b,c,d,e){var f,h,k,l,m;return h=d!=null?d.id:void 0,l=g(c,h,!0),k="",f=!0,d?l!==c&&((m=b[l])!=null?m.__template__:void 0)?(k=b[l].__template__,f=!0):f=!1:k=j.name,!d||f?resolver.resolve(k,function(f){return d=f,d.nested=!0,i(a,b,c,d,e)}):i(a,b,c,d,e)},i=function(a,b,c,d,e){var i,j,k,l,m,n,o,p,q,r,s;m=d.id,l=g(c,m),o=d.tagName.toUpperCase(),a=a||b;if(d.children!==void 0&&d.children.length>0){k=[],n=function(c){var f;k.push(c);if(k.length===d.children.length)return f=function(c,e,f,i){var j,l,n,p,q,r,s,t,u,v,w;j=m===""?i:m,u=g(f,j),v=j===u||j===void 0?e:e!=null?e[j]:void 0;if(v!=null?v.value:void 0)v=v.value;q=(v!=null?v.length:void 0)?v:v!=null?v.items:void 0;if(q&&q.length){t=[],p=k[0],a.template[u+"_add"]=function(a,b){return p(c,b,u,a)};for(s=0,w=q.length-1;0<=w?s<=w:s>=w;0<=w?s++:s--)t.push(function(){var a,b,d;d=[];for(a=0,b=k.length;a<b;a++)l=k[a],d.push(l(c,q,u,s));return d}());return n=h(a,c,o,d,u,j,t,b,e),a[u]=n,n}return r=function(){var a,b,d;d=[];for(a=0,b=k.length;a<b;a++)l=k[a],d.push(l(c,v,u));return d}(),n=h(a,c,o,d,u,j,r,b,e),a[u]=n,n},a.template[l]=f,e(f)},r=d.children,s=[];for(p=0,q=r.length;p<q;p++)j=r[p],s.push(f(a,b,l,j,function(a){return n(a)}));return s}return i=function(c,e,f,i){var j,k,n,p;return j=m===""?i:m,n=g(f,j,!0),p=j===l?e:e!=null?e[j]:void 0,k=h(a,c,o,d,n,j,p,b,e),a[n]=k,k},a.template[l]=i,e(i)},g=function(a,b,c){var d,e,f,g;return f=a||"",c&&(f=f===j.name?"":f),e=b||"",d=f!==""&&e!==""?".":"",g=""+f+d+e,g},h=function(a,b,c,d,f,g,h,i,j){var k,o,p,q;p={},q=d.textContent?d.textContent:d.value,k=h?h:q,o={};if(g||g===0)p.id=g;d&&e(d,p,n),c==="INPUT"?(_.isObject(k)||(p.value=k),o=b[c](p)):o=b[c](p,k);if(j!=null?j[g]:void 0)h instanceof Array?e(j[g],o,m):e(j[g],o,l);return o},this.apply=function(a,b){return f(j,a,"",j.element,function(c){return b(c(j.html,a))})},this.name=a,this.namespace="",this.fqn="",this.element=void 0,this.eventChannel=postal.channel(b+"_events"),this.html=DOMBuilder.dom,this.template={},this.changeSubscription=void 0,this.target=c||(c=a),resolver.resolve(a,function(a){return j.element=a}),j},turlet=function(){var a,b,c,d;return a=function(a){var b,c,d,e,f,g,h,i,j;if(a.event!=="read"){e=self[a.key],f=a.key.lastIndexOf("."),h=a.key.substring(0,f),d=a.key.substring(f+1),i="value",b=a.key;if(d==="value"||!e)e=self[h],i=d,b=h;if(a.event==="wrote"){if(d==="__template__")return cartographer.apply(a.info.value,a.parent);if(e&&self.template[b]&&a.info.value&&a.info.value.isProxy)return j=a.info.value.getRoot?a.info.value.getRoot():a.info.value,$(self[b]).replaceWith(self.template[b](self.html,j,h));if(a.info&&e)return conditionalCopy(a.info,e,"value",modelTargets[i])}else if(a.event==="added"){c=h+"_add";if(self.template[c])return g=self.template[c](d,a.parent),$(self[h]).append(g)}}},b=function(a,b,c,e,f){var g,h,i,j,k;if(a){j=_.keys(eventHandlers),k=[];for(h=0,i=j.length;h<i;h++)g=j[h],k.push(d(g,eventHandlers[g],a,b,c,e,f));return k}},c=function(b,c){return self.changeSubscription!==void 0&&self.changeSubscription.unsubscribe(),self.changeSubscription=postal.channel(c).subscribe(a)},d=function(a,b,c,d,e,f,g){var h,i;return h=c[a],h?(i=function(a){return h.apply(c,[d,{id:e,control:g[e],event:b,context:g,info:a}])},f[b]=i):f[b]=function(a){return b==="onchange"&&a.stopPropagation(),g.eventChannel.publish({id:e,model:c,control:g[e],event:b,context:g,info:a})}}}