/*
  Cartographer.js
  Author: Alex Robson <@A_Robson>
  License: MIT ( http://www.opensource.org/licenses/mit-license )
  Version: 0.2.0
*/
define(["postal","cartographer"],function(a,b){var c,d;c=function(){var c;return c=this,this.apply=function(c){var d,e,f;return e=c.name,f=c.template,d=c.model,b.apply(e,f,d,function(b,c,d){return a.publish("cartographer","render."+f,{template:f,markup:c,operation:"render"})},function(b){return a.publish("cartographer","render."+b,{template:f,error:b,operation:"render"})})},this.map=function(a){return b.map(a.name)},this.resolver=function(a){return a.order==="prepend"?b.resolver.prependSource(a.resolver):b.resolver.appendSource(a.resolver)},this.add=function(c){var d,e,f;return f=c.template,d=c.id,e=c.model,b.add(f,d,e,function(b,c,e){return a.publish("cartographer","render.{templateId}",{template:f,parent:d,markup:c,operation:"add"})})},this.update=function(c){var d,e,f;return f=c.template,d=c.id,e=c.model,b.update(f,d,e,function(b,c,e){return a.publish("cartographer","render.{templateId}",{template:f,id:d,markup:c,operation:"update"})})},this.watch=function(c){return b.watchEvent(c.template,c.event,function(b,c,d,e){return a.publish("cartographer."+b,""+c+"."+e,{element:d})})},this.ignore=function(a){return b.ignoreEvent(a.template,a.event)},a.subscribe("cartographer","api",function(a,b){var d;return d=a.operation,c[d](a)}),a.subscribe("postal","subscription.*",function(a,d){var e,f,g;if(a.exchange.match(/^cartographer[.]*/)){g=a.exchange.split(".")[1];if(b.templates[g]){f=a.topic.split("."),e={template:g,event:f[f.length-1]};if(d.topic==="subscription.created"&&a.exchange.match(/^cartographer/))return c.watch(e);if(a.exchange.match(/^cartographer/))return c.ignore(e)}}})},d=new c})