/*
  Cartographer.js
  Author: Alex Robson <@A_Robson>
  License: MIT ( http://www.opensource.org/licenses/mit-license )
  Version: 0.2.0
*/
var PostalSetup,setup;PostalSetup=function(){var a;return a=this,this.apply=function(a){var b,c,d;return c=a.name,d=a.template,b=a.model,cartographer.apply(c,d,b,function(a,b,c){return postal.publish("cartographer","render."+d,{template:d,markup:b,operation:"render"})},function(a){return postal.publish("cartographer","render."+a,{template:d,error:a,operation:"render"})})},this.map=function(a){return cartographer.map(a.name)},this.resolver=function(a){return a.order==="prepend"?cartographer.resolver.prependSource(a.resolver):cartographer.resolver.appendSource(a.resolver)},this.add=function(a){var b,c,d;return d=a.template,b=a.id,c=a.model,cartographer.add(d,b,c,function(a,c,e){return postal.publish("cartographer","render.{templateId}",{template:d,parent:b,markup:c,operation:"add"})})},this.update=function(a){var b,c,d;return d=a.template,b=a.id,c=a.model,cartographer.update(d,b,c,function(a,c,e){return postal.publish("cartographer","render.{templateId}",{template:d,id:b,markup:c,operation:"update"})})},this.watch=function(a){return cartographer.watchEvent(a.template,a.event,function(a,b,c,d){return postal.publish("cartographer."+a,""+b+"."+d,{element:c})})},this.ignore=function(a){return cartographer.ignoreEvent(a.template,a.event)},postal.subscribe("cartographer","api",function(b,c){var d;return d=b.operation,a[d](b)}),postal.subscribe("postal","subscription.*",function(b,c){var d,e,f;if(b.exchange.match(/^cartographer[.]*/)){f=b.exchange.split(".")[1];if(cartographer.templates[f]){e=b.topic.split("."),d={template:f,event:e[e.length-1]};if(c.topic==="subscription.created"&&b.exchange.match(/^cartographer/))return a.watch(d);if(b.exchange.match(/^cartographer/))return a.ignore(d)}}})},setup=new PostalSetup